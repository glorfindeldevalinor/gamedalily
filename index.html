<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quebra-Cabe√ßa de Palavras</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --grid-bg: #ffffff;
            --cell-bg: #e4e6eb;
            --cell-border: #ccd0d5;
            --cell-text: #1c1e21;
            --cell-hover-bg: #d8dade;
            --cell-selected-bg: #4c8dff;
            --cell-selected-text: #ffffff;
            --cell-hint-bg: #fffbe6;
            --cell-hint-border: #ffe58f;
            --button-bg: #4267b2;
            --button-text: #ffffff;
            --button-hover-bg: #365899;
            --accent-color: #4c8dff;
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --border-radius: 8px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--cell-text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 16px;
            box-sizing: border-box;
        }

        .game-container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        header h1 {
            text-align: center;
            color: var(--button-bg);
            margin: 0 0 16px;
        }
        
        /* HUD - Painel de informa√ß√µes e controles */
        .hud {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background-color: var(--grid-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .hud-info {
            display: flex;
            gap: 20px;
            font-size: 1.1em;
            font-weight: 500;
        }

        .hud-controls {
            display: flex;
            gap: 10px;
        }

        .hud-controls button {
            font-family: var(--font-family);
            font-size: 1em;
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background-color: var(--button-bg);
            color: var(--button-text);
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        .hud-controls button:hover {
            background-color: var(--button-hover-bg);
        }
        
        .hud-controls button:active {
            transform: scale(0.95);
        }

        .hud-controls button:disabled {
            background-color: #9db2d5;
            cursor: not-allowed;
        }

        /* Grade do jogo */
        #game-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 8px;
            background-color: var(--grid-bg);
            padding: 12px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            aspect-ratio: 1 / 1;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none; 
        }

        .grid-cell {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(1.2rem, 5vw, 2.2rem);
            font-weight: bold;
            background-color: var(--cell-bg);
            border: 2px solid var(--cell-border);
            border-radius: 6px;
            cursor: grab;
            transition: background-color 0.2s, color 0.2s, transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .grid-cell:focus {
            outline: none;
            box-shadow: 0 0 0 3px var(--accent-color);
            z-index: 10;
        }
        
        .grid-cell.dragging {
            opacity: 0.5;
            cursor: grabbing;
            transform: scale(1.1);
        }

        .grid-cell.selected {
            background-color: var(--cell-selected-bg);
            color: var(--cell-selected-text);
            border-color: var(--accent-color);
        }

        .grid-cell.hint {
            animation: hint-pulse 1s ease-in-out 2;
        }

        @keyframes hint-pulse {
            0%, 100% { background-color: var(--cell-hint-bg); border-color: var(--cell-hint-border); }
            50% { background-color: var(--cell-bg); border-color: var(--cell-border); }
        }

        /* Modal de vit√≥ria */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 1000;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            padding: 30px 40px;
            border-radius: var(--border-radius);
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-content h2 {
            font-size: 2em;
            color: var(--button-bg);
            margin-top: 0;
        }

        .modal-content p {
            font-size: 1.2em;
            margin-bottom: 25px;
        }

        /* Anima√ß√£o de confete */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            animation: confetti-fall 4s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <header>
            <h1>Quebra-Cabe√ßa de Palavras</h1>
        </header>

        <div class="hud">
            <div class="hud-info">
                <span id="moves-counter">Movimentos: 0</span>
                <span id="timer">Tempo: 00:00</span>
            </div>
            <div class="hud-controls">
                <button id="hint-btn" aria-label="Pedir uma dica">Dica (3)</button>
                <button id="undo-btn" aria-label="Desfazer √∫ltimo movimento">Desfazer</button>
                <button id="new-game-btn" aria-label="Iniciar um novo jogo">Novo Jogo</button>
            </div>
        </div>
        
        <div id="game-grid" role="grid" aria-label="Grade do quebra-cabe√ßa de palavras"></div>
    </div>

    <div id="win-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="win-message">Parab√©ns! üéâ</h2>
            <p>Voc√™ organizou todos os nomes!</p>
            <p id="win-stats"></p>
            <button id="play-again-btn">Jogar Novamente</button>
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ÉO DO JOGO ---
        // Adicione 5 palavras de 5 letras aqui para personalizar o jogo.
        const TARGET_WORDS = ["HENZO", "ALICE", "HELEN", "MARIA", "PAULO"];

        // --- ELEMENTOS DA DOM ---
        const gridElement = document.getElementById('game-grid');
        const movesCounterElement = document.getElementById('moves-counter');
        const timerElement = document.getElementById('timer');
        const newGameBtn = document.getElementById('new-game-btn');
        const undoBtn = document.getElementById('undo-btn');
        const hintBtn = document.getElementById('hint-btn');
        const winModal = document.getElementById('win-modal');
        const winStatsElement = document.getElementById('win-stats');
        const playAgainBtn = document.getElementById('play-again-btn');

        // --- ESTADO DO JOGO ---
        let gameState = {
            grid: [],
            moves: 0,
            time: 0,
            timerInterval: null,
            isGameActive: false,
            selectedCellIndex: null,
            moveHistory: [],
            hintsLeft: 3,
            solution: TARGET_WORDS.join('').split('')
        };
        
        // --- FUN√á√ïES PRINCIPAIS ---

        /**
         * Inicializa ou reinicia o jogo.
         */
        function initGame() {
            // 1. Validar as palavras alvo
            if (!validateWords(TARGET_WORDS)) {
                console.error("Configura√ß√£o de palavras inv√°lida. O jogo requer 5 palavras de 5 letras cada.");
                gridElement.innerHTML = "<p>Erro na configura√ß√£o das palavras. Verifique o console.</p>";
                return;
            }

            // 2. Resetar o estado
            resetGameState();
            
            // 3. Checar por jogo salvo
            if (localStorage.getItem('savedWordPuzzle')) {
                if (confirm('Deseja continuar o jogo anterior?')) {
                    loadGame();
                } else {
                    localStorage.removeItem('savedWordPuzzle');
                    setupNewGame();
                }
            } else {
                setupNewGame();
            }

            // 4. Renderizar a grade e atualizar a UI
            renderGrid();
            updateHUD();
        }

        /**
         * Configura um novo jogo do zero.
         */
        function setupNewGame() {
            gameState.solution = TARGET_WORDS.join('').split('');
            let flatLetters = [...gameState.solution];

            // Embaralha at√© que n√£o esteja resolvido
            do {
                shuffleArray(flatLetters);
            } while (isSolved(flatLetters));
            
            gameState.grid = flatLetters;
        }

        /**
         * Renderiza a grade na tela com base no estado atual.
         */
        function renderGrid() {
            gridElement.innerHTML = '';
            gridElement.setAttribute('aria-label', `Grade do quebra-cabe√ßa, ${TARGET_WORDS.length} linhas, ${TARGET_WORDS[0].length} colunas`);

            gameState.grid.forEach((letter, index) => {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.textContent = letter;
                cell.dataset.index = index;
                
                // Atributos de acessibilidade
                const row = Math.floor(index / 5) + 1;
                const col = (index % 5) + 1;
                cell.setAttribute('role', 'gridcell');
                cell.setAttribute('tabindex', '0');
                cell.setAttribute('aria-label', `Linha ${row}, Coluna ${col}, letra ${letter}`);

                // Adicionar estado de sele√ß√£o
                if (index === gameState.selectedCellIndex) {
                    cell.classList.add('selected');
                }

                // Adicionar eventos
                addCellEventListeners(cell);
                gridElement.appendChild(cell);
            });
        }
        
        /**
         * Adiciona os eventos necess√°rios a uma c√©lula da grade.
         */
        function addCellEventListeners(cell) {
            const index = parseInt(cell.dataset.index);

            // Eventos de Drag and Drop
            cell.draggable = true;
            cell.addEventListener('dragstart', (e) => handleDragStart(e, index));
            cell.addEventListener('dragover', handleDragOver);
            cell.addEventListener('drop', (e) => handleDrop(e, index));
            cell.addEventListener('dragend', handleDragEnd);

            // Eventos de Toque/Clique
            cell.addEventListener('click', () => handleCellClick(index));
            
            // Eventos de Teclado
            cell.addEventListener('keydown', (e) => handleKeyDown(e, index));
        }

        /**
         * Troca a posi√ß√£o de duas letras na grade.
         * @param {number} index1
         * @param {number} index2
         */
        function swapCells(index1, index2) {
            if (index1 === index2) return;
            
            // Inicia o cron√¥metro no primeiro movimento
            if (!gameState.isGameActive && gameState.moves === 0) {
                startGameTimer();
            }

            // Grava o movimento para o "Desfazer"
            gameState.moveHistory.push({ from: index1, to: index2 });

            // Executa a troca
            [gameState.grid[index1], gameState.grid[index2]] = [gameState.grid[index2], gameState.grid[index1]];

            gameState.moves++;
            gameState.isGameActive = true;
            
            renderGrid();
            updateHUD();
            saveGame();

            if (isSolved(gameState.grid)) {
                handleWin();
            }
        }
        
        /**
         * Verifica se a grade est√° na configura√ß√£o de vit√≥ria.
         * @param {string[]} gridToCheck - A grade a ser verificada.
         * @returns {boolean}
         */
        function isSolved(gridToCheck) {
            return gridToCheck.every((letter, i) => letter === gameState.solution[i]);
        }
        
        /**
         * Lida com o evento de vit√≥ria.
         */
        function handleWin() {
            stopGameTimer();
            localStorage.removeItem('savedWordPuzzle');
            winStatsElement.textContent = `Feito em ${gameState.moves} movimentos e ${formatTime(gameState.time)}.`;
            winModal.classList.add('show');
            launchConfetti();
        }

        // --- L√ìGICA DE MOVIMENTO ---

        function handleCellClick(index) {
            if (gameState.selectedCellIndex === null) {
                // Primeira sele√ß√£o
                gameState.selectedCellIndex = index;
                document.querySelector(`[data-index='${index}']`).classList.add('selected');
            } else {
                // Segunda sele√ß√£o: troca
                if (gameState.selectedCellIndex !== index) {
                    swapCells(gameState.selectedCellIndex, index);
                }
                gameState.selectedCellIndex = null;
                // a re-renderiza√ß√£o remover√° a classe 'selected'
            }
        }
        
        let dragStartIndex;
        function handleDragStart(e, index) {
            dragStartIndex = index;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault(); // Necess√°rio para permitir o drop
        }

        function handleDrop(e, dropIndex) {
            e.preventDefault();
            if (dragStartIndex !== dropIndex) {
                swapCells(dragStartIndex, dropIndex);
            }
        }
        
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleKeyDown(e, index) {
            let newIndex = index;
            let handled = false;

            switch (e.key) {
                case 'ArrowUp': newIndex = (index - 5 + 25) % 25; handled = true; break;
                case 'ArrowDown': newIndex = (index + 5) % 25; handled = true; break;
                case 'ArrowLeft': newIndex = (index % 5 === 0) ? index + 4 : index - 1; handled = true; break;
                case 'ArrowRight': newIndex = (index % 5 === 4) ? index - 4 : index + 1; handled = true; break;
                case 'Enter':
                case ' ':
                    e.preventDefault();
                    handleCellClick(index);
                    break;
            }

            if (handled) {
                e.preventDefault();
                const nextCell = document.querySelector(`[data-index='${newIndex}']`);
                if (nextCell) nextCell.focus();
            }
            
            // Atalho para desfazer
            if (e.ctrlKey && e.key === 'z') {
                undoMove();
            }
        }
        
        // --- FUN√á√ïES DOS BOT√ïES E HUD ---

        function undoMove() {
            if (gameState.moveHistory.length === 0) return;

            const lastMove = gameState.moveHistory.pop();
            // Desfaz a troca
            [gameState.grid[lastMove.from], gameState.grid[lastMove.to]] = [gameState.grid[lastMove.to], gameState.grid[lastMove.from]];
            gameState.moves--;
            
            renderGrid();
            updateHUD();
            saveGame();
        }

        function giveHint() {
            if (gameState.hintsLeft <= 0) return;

            // Encontrar a primeira c√©lula incorreta
            let incorrectIndex = -1;
            for (let i = 0; i < gameState.grid.length; i++) {
                if (gameState.grid[i] !== gameState.solution[i]) {
                    incorrectIndex = i;
                    break;
                }
            }

            if (incorrectIndex === -1) return; // Jogo j√° est√° resolvido

            // Encontrar onde a letra correta est√°
            const correctLetter = gameState.solution[incorrectIndex];
            const letterCurrentIndex = gameState.grid.indexOf(correctLetter, incorrectIndex);

            // Destacar as duas c√©lulas
            const incorrectCell = document.querySelector(`[data-index='${incorrectIndex}']`);
            const correctCell = document.querySelector(`[data-index='${letterCurrentIndex}']`);
            
            if(incorrectCell) incorrectCell.classList.add('hint');
            if(correctCell) correctCell.classList.add('hint');

            setTimeout(() => {
                if(incorrectCell) incorrectCell.classList.remove('hint');
                if(correctCell) correctCell.classList.remove('hint');
            }, 2000);

            gameState.hintsLeft--;
            updateHUD();
        }

        function updateHUD() {
            movesCounterElement.textContent = `Movimentos: ${gameState.moves}`;
            timerElement.textContent = `Tempo: ${formatTime(gameState.time)}`;
            undoBtn.disabled = gameState.moveHistory.length === 0;
            hintBtn.disabled = gameState.hintsLeft === 0;
            hintBtn.textContent = `Dica (${gameState.hintsLeft})`;
        }
        
        // --- CRON√îMETRO ---
        
        function startGameTimer() {
            if (gameState.timerInterval) clearInterval(gameState.timerInterval);
            gameState.isGameActive = true;
            gameState.timerInterval = setInterval(() => {
                gameState.time++;
                updateHUD();
                saveGame(); // Salva o tempo tamb√©m
            }, 1000);
        }

        function stopGameTimer() {
            clearInterval(gameState.timerInterval);
            gameState.isGameActive = false;
        }

        function resetGameState() {
            stopGameTimer();
            gameState.grid = [];
            gameState.moves = 0;
            gameState.time = 0;
            gameState.timerInterval = null;
            gameState.isGameActive = false;
            gameState.selectedCellIndex = null;
            gameState.moveHistory = [];
            gameState.hintsLeft = 3;
        }

        // --- PERSIST√äNCIA (localStorage) ---

        function saveGame() {
            if (gameState.isGameActive) {
                localStorage.setItem('savedWordPuzzle', JSON.stringify(gameState));
            }
        }

        function loadGame() {
            const savedState = JSON.parse(localStorage.getItem('savedWordPuzzle'));
            if (savedState) {
                // Recarrega o estado, mas n√£o o timerInterval
                gameState = {
                    ...savedState,
                    timerInterval: null,
                    selectedCellIndex: null // Reseta a sele√ß√£o visual
                };
                if(gameState.isGameActive) {
                    startGameTimer();
                }
            }
        }
        
        // --- FUN√á√ïES UTILIT√ÅRIAS ---
        
        function validateWords(words) {
            if (!Array.isArray(words) || words.length !== 5) return false;
            return words.every(word => typeof word === 'string' && word.length === 5);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60).toString().padStart(2, '0');
            const sec = (seconds % 60).toString().padStart(2, '0');
            return `${min}:${sec}`;
        }
        
        function launchConfetti() {
            const modalContent = winModal.querySelector('.modal-content');
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                confetti.style.width = `${Math.floor(Math.random() * 8) + 5}px`;
                confetti.style.height = confetti.style.width;
                modalContent.appendChild(confetti);

                setTimeout(() => confetti.remove(), 4000);
            }
        }

        // --- EVENT LISTENERS GLOBAIS ---
        newGameBtn.addEventListener('click', () => {
             localStorage.removeItem('savedWordPuzzle');
             initGame();
        });
        undoBtn.addEventListener('click', undoMove);
        hintBtn.addEventListener('click', giveHint);
        playAgainBtn.addEventListener('click', () => {
            winModal.classList.remove('show');
            initGame();
        });

        // --- INICIAR O JOGO ---
        document.addEventListener('DOMContentLoaded', initGame);
    </script>

</body>
</html>
